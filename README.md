# UltraSur: Supplementary Data and Code Repository

**Title:** UltraSur: An Integrated Web Platform for Multi-Omics Survival Analysis, Multivariate Modeling, and Biomarker Discovery in Cancer
*(Note: This repository supports the manuscript submitted to [Journal Name])*

## 1. Overview
This repository contains the data acquisition manifest, preprocessing logic, and reproducible analysis scripts for **UltraSur**, a web-based platform for cancer survival analysis. 

The code provided here serves two primary purposes:
1.  **Transparency:** To explicitly demonstrate how raw probe-level methylation data is mapped to gene-level data.
2.  **Reproducibility:** To provide a standalone, executable pipeline that reproduces the statistical results (Cox regression, Kaplan-Meier analysis, and optimal cutoff determination) generated by the UltraSur web server.

---

## 2. Data Acquisition Manifest

All multi-omics data analyzed in UltraSur were retrieved from the **UCSC Xena Pan-Cancer (PANCAN)** hub.

* **Source:** [UCSC Xena TCGA Pan-Cancer Hub](https://xenabrowser.net/datapages/?cohort=TCGA%20Pan-Cancer%20(PANCAN)&removeHub=https%3A%2F%2Fxena.treehouse.gi.ucsc.edu%3A443)
* **Access Date:** December 24, 2024
* **Dataset Details:** Please refer to the file **[`dataset.csv`](./dataset.csv)** in this repository for a complete list of downloaded files, including exact dataset IDs, version numbers, and file names.

### Key Datasets Used:
* **Gene Expression:** `EB++AdjustPANCAN_IlluminaHiSeq_RNASeqV2`
* **DNA Methylation:** `jhu-usc.edu_PANCAN_HumanMethylation450`
* **Somatic Mutation:** `mc3.v0.2.8.PUBLIC.maf.gz`
* **Clinical Data:** `Survival_SupplementalTable_S1_20171025_xena_sp`

---

## 3. Code & Scripts

### A. Methylation Preprocessing (`methylation_preprocess.R`)
This script addresses the challenge of mapping multiple methylation probes to a single gene symbol. 

* **Function:** It demonstrates the specific logic used in the UltraSur backend to convert probe-level Beta values to gene-level methylation estimates.
* **Methodology:** As described in the manuscript, the pipeline uses the platform annotation manifest to map probes. When multiple probes map to the same gene, the **first occurring probe** in the annotation file is retained to represent the gene's methylation level.
* **Input:** Raw probe-level Beta value matrix.
* **Output:** Gene-level methylation matrix.

### B. Analysis Demo (`run_analysis_demo.R`)
This script allows users to reproduce the survival analysis results locally, ensuring the statistical validity of the web tool.

* **Function:** It performs the complete survival analysis workflow for a sample gene (e.g., *MKI67* in BRCA).
* **Workflow Steps:**
    1.  **Data Loading:** Loads expression data and clinical survival data.
    2.  **Stratification:** Demonstrates grouping strategies including **Median** split and **Optimal Cutoff** (using Maximally Selected Rank Statistics).
    3.  **Survival Analysis:** Performs Kaplan-Meier estimation and Log-rank tests.
    4.  **Multivariate Analysis:** Runs Cox Proportional Hazards regression.
    5.  **Visualization:** Generates survival curves and forest plots.

---

## 4. Prerequisites & Installation

To run the provided scripts, you need **R (version 4.0.0 or higher)** and the following dependencies. You can install them using the code below:

```r
install.packages(c("survival", "survminer", "maxstat", "ggplot2", "dplyr", "data.table"))